<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JQ Assessment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --cq-orange: #EB633F;
      --cq-teal:   #2DA193;
      --bg-light:  #f7f7f7;
      --border-light: #dddddd;

      --risk:  #c9302c;
      --watch: #d58512;
      --strong:#1d7f56;
    }

    * { box-sizing: border-box; font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

    body {
      margin: 0;
      padding: 1.5rem;
      background: var(--bg-light);
      color: #222;
    }

    .assessment-wrapper {
      max-width: 1100px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 10px;
      padding: 1.75rem 2rem 2.25rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
    }

    h1 {
      text-align: center;
      color: var(--cq-teal);
      margin: 0 0 0.3rem 0;
      font-size: 1.8rem;
      letter-spacing: 0.02em;
    }

    /* Superscript sizing so ® is smaller/less noticeable */
    sup {
      font-size: 0.6em;
      vertical-align: super;
      line-height: 0;
    }

    .subtitle {
      text-align: center;
      font-size: 0.95rem;
      margin-bottom: 1.2rem;
      color: #444;
    }

    .intro-screen {
      margin-top: 0.5rem;
      margin-bottom: 1.5rem;
      padding: 1.1rem 1.2rem;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      background: #fff7f3;
    }

    .intro-heading { font-weight: 700; font-size: 1.05rem; margin-bottom: 0.45rem; color:#222; }
    .intro-text-main { font-size: 0.92rem; margin-bottom: 0.5rem; color:#333; }

    .intro-bullets {
      font-size: 0.85rem;
      margin: 0 0 0.9rem 0;
      padding-left: 1.1rem;
      color: #555;
    }
    .intro-bullets li { margin-bottom: 0.2rem; }

    .intro-buttons { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; }

    .intro-form {
      margin-top: 0.8rem;
      padding-top: 0.8rem;
      border-top: 1px dashed #e2b29b;
    }

    .intro-form label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
      color:#222;
    }

    .intro-form input[type="email"] {
      width: 100%;
      max-width: 420px;
      padding: 0.45rem 0.6rem;
      border-radius: 6px;
      border: 1px solid var(--border-light);
      font-size: 0.92rem;
      margin-bottom: 0.55rem;
      background:#fff;
    }

    .intro-later-thanks {
      margin-top: 0.8rem;
      padding: 0.6rem 0.7rem;
      background: #f2fbfa;
      border-left: 4px solid var(--cq-teal);
      border-radius: 8px;
      font-size: 0.92rem;
      color:#1b3f3a;
    }

    .progress-wrap { display: grid; gap: 0.5rem; margin: 0.8rem 0 1.0rem 0; }

    .progress-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .progress-scenario { font-weight: 700; color: var(--cq-orange); font-size: 0.95rem; }
    .progress-count { font-size: 0.85rem; color: #666; }

    .progress-bar {
      height: 10px;
      background: #f0f0f0;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--border-light);
    }

    .progress-bar > div {
      height: 100%;
      width: 0%;
      background: var(--cq-teal);
      transition: width 220ms ease;
    }

    .scenario-card { border: 1px solid var(--border-light); border-radius: 10px; overflow: hidden; margin-bottom: 0.9rem; }
    .scenario-header { padding: 0.6rem 0.9rem; background: #fff5f1; border-bottom: 1px solid var(--border-light); font-weight: 700; font-size: 0.95rem; color: var(--cq-orange); }
    .scenario-body { padding: 0.9rem 0.9rem 1.0rem; background: #ffffff; }
    .scenario-body p { margin: 0 0 0.55rem 0; font-size: 0.9rem; color: #333; line-height: 1.45; }

    /* Italicize scenario subtitle line */
    #scenarioSubtitle { font-style: italic; }

    .question-card { border: 1px solid var(--border-light); border-radius: 10px; overflow: hidden; }
    .question-header { padding: 0.6rem 0.9rem; background: #f2fbfa; border-bottom: 1px solid var(--border-light); font-weight: 700; color: var(--cq-teal); font-size: 0.95rem; }
    .question-body { padding: 0.85rem 0.9rem 0.95rem; }
    .question-prompt { margin: 0 0 0.75rem 0; font-size: 0.95rem; line-height: 1.45; color:#222; }

    .options { display: grid; gap: 0.55rem; }
    .option {
      border: 1px solid var(--border-light);
      border-radius: 10px;
      padding: 0.6rem 0.65rem;
      display: grid;
      grid-template-columns: 18px 1fr;
      gap: 0.55rem;
      align-items: start;
      cursor: pointer;
      background: #fff;
    }
    .option:hover { background: #fafafa; }
    .option input { margin-top: 2px; cursor: pointer; }
    .option .opt-text { font-size: 0.9rem; color: #222; line-height: 1.35; }

    .likert-row { display: grid; grid-template-columns: repeat(5, minmax(42px, 1fr)); gap: 0.5rem; margin-top: 0.15rem; }
    .likert-pill {
      border: 1px solid var(--border-light);
      border-radius: 999px;
      padding: 0.45rem 0.35rem;
      text-align: center;
      cursor: pointer;
      user-select: none;
      background: #fff;
      font-weight: 700;
      color: #333;
      font-size: 0.9rem;
    }
    .likert-pill:hover { background: #fafafa; }
    .likert-pill.selected { background: #f2fbfa; border-color: var(--cq-teal); color: var(--cq-teal); }

    .likert-labels { display: flex; justify-content: space-between; font-size: 0.8rem; color: #666; margin-top: 0.4rem; }

    .rank-box {
      margin-top: 0.75rem;
      padding: 0.65rem 0.75rem;
      border-radius: 10px;
      border: 1px dashed #e2b29b;
      background: #fffaf7;
      font-size: 0.85rem;
      color: #444;
    }
    .rank-grid { display: grid; gap: 0.55rem; margin-top: 0.55rem; }
    .rank-row { display: grid; grid-template-columns: 1fr 150px; gap: 0.55rem; align-items: center; }
    .rank-row select { width: 100%; padding: 0.38rem 0.45rem; border: 1px solid var(--border-light); border-radius: 8px; font-size: 0.85rem; background: #fff; }

    .actions { margin-top: 0.95rem; display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; justify-content: flex-start; }

    .btn-primary {
      background: var(--cq-teal);
      color: #ffffff;
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.4rem;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 0.02em;
    }
    .btn-primary:hover { background: #248376; }

    .btn-secondary {
      background: transparent;
      color: var(--cq-orange);
      border-radius: 999px;
      border: 1px solid var(--cq-orange);
      padding: 0.45rem 1.2rem;
      font-size: 0.85rem;
      font-weight: 700;
      cursor: pointer;
    }
    .btn-secondary:hover { background: #fff3ee; }

    .btn-disabled { opacity: 0.45; cursor: not-allowed; }

    .results { margin-top: 1.3rem; border-top: 2px solid var(--border-light); padding-top: 0.9rem; font-size: 0.9rem; }
    .results h2 { font-size: 1.05rem; margin: 0 0 0.4rem 0; color: var(--cq-teal); font-weight: 800; }
    .results .completion-text { margin: 0.15rem 0 0.8rem 0; color:#333; line-height:1.45; }

    .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 0.55rem 0.9rem; margin-bottom: 0.7rem; }

    .badge { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 999px; font-size: 0.75rem; font-weight: 800; color: #ffffff; margin-left: 0.25rem; vertical-align: middle; }
    .badge-low  { background: #d9534f; }
    .badge-mid  { background: #f0ad4e; }
    .badge-high { background: #5cb85c; }

    .score-strong { color: var(--strong); font-weight: 700; }
    .score-watch  { color: var(--watch);  font-weight: 700; }
    .score-risk   { color: var(--risk);   font-weight: 700; }

    .scoring-guide { margin-top: 0.7rem; padding: 0.55rem 0.75rem; background: #fff7f3; border-left: 3px solid var(--cq-orange); border-radius: 8px; font-size: 0.82rem; color:#333; }
    .scoring-guide ul { padding-left: 1.1rem; margin: 0.25rem 0 0; }
    .scoring-guide li { margin-bottom: 0.1rem; }

    .results-ctas { margin-top: 1.1rem; padding-top: 0.95rem; border-top: 1px dashed var(--border-light); display: grid; gap: 0.8rem; }
    .results-cta-block { display: flex; flex-wrap: wrap; gap: 0.6rem; align-items: center; border-radius: 10px; border: 1px solid var(--border-light); padding: 0.8rem 0.9rem; }
    .results-cta-block p { margin: 0; font-size: 0.92rem; flex: 1 1 auto; color:#222; }
    .results-cta-share   { background: #f2fbfa; border-left: 4px solid var(--cq-teal); }
    .results-cta-krishna { background: #fff7f3; border-left: 4px solid var(--cq-orange); }

    .note { font-size: 0.82rem; color: #666; margin-top: 0.55rem; line-height: 1.4; }

    @media print {
      body { padding: 0; background: #ffffff; }
      .assessment-wrapper { box-shadow: none; border-radius: 0; max-width: none; }
      .intro-screen { display: none !important; }
      .results-ctas { display: none !important; }
      .actions { display: none !important; }
    }

    @media (max-width: 768px) {
      body { padding: 1rem; }
      .assessment-wrapper { padding: 1.25rem 1.2rem 1.6rem; }
      h1 { font-size: 1.5rem; }
      .subtitle { font-size: 0.9rem; }
      .rank-row { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="assessment-wrapper">
    <h1>Judgment Quotient<sup>®</sup> (JQ<sup>®</sup>) Assessment</h1>
    <p class="subtitle">Proficiency-focused, scenario-based instrument (estimated 15–20 minutes).</p>

    <div id="intro-screen" class="intro-screen">
      <div class="intro-heading">Instructions</div>
      <div class="intro-text-main">
        There are no right or wrong answers. Select the option that best reflects what you typically do, not what you should do.
      </div>
      <ul class="intro-bullets">
        <li>You may find more than one option as applicable; choose the closest.</li>
        <li>Work at a steady pace; do not overthink individual questions.</li>
        <li>This assessment produces a Judgment Proficiency Profile and band placement.</li>
      </ul>

      <div class="intro-heading" style="margin-top:0.9rem;">When would you like to do this?</div>

      <div id="intro-choices" class="intro-buttons">
        <button class="btn-primary" type="button" onclick="showTakeLaterForm()">Take It Later</button>
        <button class="btn-secondary" type="button" onclick="showTakeNowForm()">Take It Now</button>
      </div>

      <div id="intro-later-form" class="intro-form" style="display:none;">
        <label for="reminderEmail">Enter your email so we can send you a link to take this assessment later:</label>
        <input type="email" id="reminderEmail" placeholder="you@example.com" />
        <div class="intro-buttons" style="margin-top:0.35rem;">
          <button class="btn-primary" type="button" onclick="submitTakeLaterEmail()">Submit</button>
          <button class="btn-secondary" type="button" onclick="backToIntroChoices()">Back</button>
        </div>
        <div class="note">Your email is used only to deliver the link and to produce a Judgment Proficiency Profile.</div>
      </div>

      <div id="intro-later-thanks" class="intro-later-thanks" style="display:none;">
        Thank you. You'll receive an email along with the assessment link.
      </div>

      <div id="intro-now-form" class="intro-form" style="display:none;">
        <label for="startNowEmail">Enter your email to start the assessment:</label>
        <input type="email" id="startNowEmail" placeholder="you@example.com" />
        <div class="intro-buttons" style="margin-top:0.35rem;">
          <button class="btn-primary" type="button" onclick="submitTakeNowEmail()">Start Assessment</button>
          <button class="btn-secondary" type="button" onclick="backToIntroChoices()">Back</button>
        </div>
        <div class="note">Your email is used to produce a Judgment Proficiency Profile. It will not be shared.</div>
      </div>
    </div>

    <div id="assessment-screen" style="display:none;">

      <!-- Progress bar: entire assessment -->
      <div class="progress-wrap">
        <div class="progress-top">
          <div class="progress-scenario" id="progressScenario">Progress</div>
          <div class="progress-count" id="progressCount">Question 1 of 19</div>
        </div>
        <div class="progress-bar"><div id="progressBarFill"></div></div>
      </div>

      <div class="scenario-card" id="scenarioCard" style="display:none;">
        <div class="scenario-header" id="scenarioTitle">Scenario</div>
        <div class="scenario-body">
          <p id="scenarioSubtitle" style="margin-bottom:0.35rem; color:#555; font-size:0.88rem;"></p>
          <p id="scenarioContext"></p>
        </div>
      </div>

      <!-- Hidden email only (no mid-page email display) -->
      <input type="hidden" id="userEmail" />

      <div class="question-card">
        <div class="question-header" id="questionHeader">Question</div>
        <div class="question-body">
          <p class="question-prompt" id="questionPrompt"></p>
          <div id="questionOptions"></div>

          <div id="rankBox" class="rank-box" style="display:none;">
            <div><strong>Now rank the remaining three items</strong> from most acceptable to least acceptable.</div>
            <div class="rank-grid" id="rankGrid"></div>
          </div>

          <div class="actions">
            <button class="btn-secondary" type="button" onclick="prevQuestion()" id="btnPrev">Back</button>
            <button class="btn-primary btn-disabled" type="button" onclick="nextQuestion()" id="btnNext" disabled>Next</button>
          </div>
        </div>
      </div>

      <iframe name="hidden_iframe" style="display:none;"></iframe>

      <form id="takeLaterForm" action="" method="POST" target="hidden_iframe" style="display:none;">
        <input type="hidden" name="mode" value="take_later">
        <input type="hidden" name="email" id="takeLaterEmail">
      </form>

      <form id="startNowForm" action="" method="POST" target="hidden_iframe" style="display:none;">
        <input type="hidden" name="mode" value="start_now">
        <input type="hidden" name="email" id="startNowHiddenEmail">
      </form>

      <form id="submissionForm" action="" method="POST" target="hidden_iframe" style="display:none;">
        <input type="hidden" name="mode" value="completed">
        <input type="hidden" name="email" id="formEmail">

        <input type="hidden" name="decision_framing" id="formDecisionFraming">
        <input type="hidden" name="tradeoff_ownership" id="formTradeoffOwnership">
        <input type="hidden" name="instinct_regulation" id="formInstinctRegulation">
        <input type="hidden" name="temporal_judgment" id="formTemporalJudgment">
        <input type="hidden" name="commitment_discipline" id="formCommitmentDiscipline">

        <input type="hidden" name="judgment_stability" id="formJudgmentStability">
        <input type="hidden" name="core_average" id="formCoreAverage">
        <input type="hidden" name="band" id="formBand">

        <input type="hidden" name="confidence_calibration" id="formConfidenceCalibration">

        <!-- Timing -->
        <input type="hidden" name="start_ms" id="formStartMs">
        <input type="hidden" name="end_ms" id="formEndMs">
        <input type="hidden" name="duration_sec" id="formDurationSec">
      </form>

      <!-- Distinct completion screen -->
      <div class="results" id="completedScreen" style="display:none;">
        <h2>Completed</h2>
        <p class="completion-text">
          Thank you for completing the JQ Assessment. Your responses have been recorded.
        </p>
        <div class="actions">
          <button class="btn-primary" type="button" onclick="showResults()">See Results</button>
        </div>
      </div>

      <!-- Results report -->
      <div class="results" id="results" style="display:none;">
        <h2>Your JQ Proficiency Profile</h2>

        <div id="dimensionResults" class="results-grid"></div>

        <p id="bandText" style="margin:0.2rem 0 0.6rem 0;"></p>
        <div id="bandInterpretation"></div>

        <div class="scoring-guide">
          <strong>JQ Proficiency Bands:</strong>
          <ul>
            <li><strong>Band 1</strong> - Fragile (Avg &lt; 2.0 OR any dimension &lt; 1.8)</li>
            <li><strong>Band 2</strong> - Situational (Avg 2.0–2.9 AND Stability ≥ 2.0)</li>
            <li><strong>Band 3</strong> - Functional (Avg 3.0–3.7 AND Stability ≥ 3.0)</li>
            <li><strong>Band 4</strong> - Advanced (Avg 3.8–4.4 AND Stability ≥ 3.6)</li>
            <li><strong>Band 5</strong> - Expert (Avg ≥ 4.5 AND Stability ≥ 4.2)</li>
          </ul>
        </div>

        <div class="results-ctas">
          <div class="results-cta-block results-cta-share">
            <p>Please get everyone you trust in your team to take this assessment.</p>
            <button class="btn-primary" type="button" onclick="shareAssessment()">Share this assessment</button>
          </div>
          <div class="results-cta-block results-cta-krishna">
            <p>For a deeper review of this assessment, please schedule a brief Zoom call with Krishna.</p>
            <button class="btn-secondary" type="button" onclick="openKrishnaBooking()">Schedule a time with Krishna</button>
          </div>
        </div>

        <div class="actions" style="margin-top: 1rem;">
          <button class="btn-primary" type="button" onclick="printPage()">Print / Save PDF</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx_Qf5YWto7uI32dGWXqkhHfkg4BLmBWeE19n2UXTwXlb_hDzPuGDXn39AsUYbCnnZ7Ig/exec";

    const DIM_LABEL = {
      DF: "Decision Framing",
      TO: "Tradeoff Ownership",
      IR: "Instinct Regulation",
      TJ: "Temporal Judgment",
      CD: "Commitment Discipline",
      JS: "Judgment Stability (Stress Signal)"
    };

    let assessmentEmail = "";
    let currentIndex = 0;
    const answers = {};

    // Timing
    let assessmentStartMs = null;

    // Completion -> results handoff
    let lastComputedResults = null;

    const questionnaire = [
      {
        scenarioId: "S1",
        title: "Scenario 1: Operational / Managerial Judgment",
        subtitle: "Everyday reliability under moderate constraints",
        context:
          "You begin the week with multiple competing demands. Three direct reports need timely decisions to proceed. A customer issue has escalated but is not yet critical. A strategic deliverable is due in two weeks. You do not have enough time to meaningfully engage on everything this week.",
        questions: [
          {
            id: "q1",
            prompt: "Which framing best represents the decision you need to make?",
            type: "mcq",
            dimension: "DF",
            options: [
              { id: "A", text: "How to respond quickly to the most vocal requests", score: 2 },
              { id: "B", text: "How to minimize dissatisfaction across stakeholders", score: 3 },
              { id: "C", text: "How to allocate limited attention across competing priorities", score: 5 },
              { id: "D", text: "How to personally work longer hours to cover the gap", score: 1 }
            ]
          },
          {
            id: "q2",
            prompt: "Which cost are you most willing to accept this week?",
            type: "mcq_rank",
            dimension: "TO",
            options: [
              { id: "A", text: "Short-term frustration from some stakeholders", score: 5 },
              { id: "B", text: "Slower progress on longer-term strategic work", score: 4 },
              { id: "C", text: "Reduced availability to your team", score: 3 },
              { id: "D", text: "Increased personal workload", score: 2 }
            ],
            rankRequired: true
          },
          {
            id: "q3",
            prompt: "How strong is your initial instinct to act immediately and clear requests as fast as possible?",
            type: "likert_awareness",
            dimension: "IR",
            minLabel: "Very weak",
            maxLabel: "Very strong",
            likertMap: { 1:2, 2:3, 3:4, 4:5, 5:5 }
          },
          {
            id: "q4",
            prompt: "Which best describes how you act on that instinct?",
            type: "mcq",
            dimension: "IR",
            options: [
              { id: "A", text: "I generally follow it", score: 2 },
              { id: "B", text: "I notice it but often defer to it anyway", score: 3 },
              { id: "C", text: "I deliberately slow down before deciding", score: 5 },
              { id: "D", text: "I largely ignore instinct in favor of process", score: 4 }
            ]
          },
          {
            id: "q5",
            prompt: "Which outcome most strongly guides your decision?",
            type: "mcq",
            dimension: "TJ",
            options: [
              { id: "A", text: "Immediate responsiveness", score: 2 },
              { id: "B", text: "Avoiding escalation", score: 3 },
              { id: "C", text: "Sustaining momentum over the next several weeks", score: 5 },
              { id: "D", text: "Preserving optionality for later decisions", score: 4 }
            ]
          },
          {
            id: "q6",
            prompt: "Which best describes how you commit in this situation?",
            type: "mcq",
            dimension: "CD",
            options: [
              { id: "A", text: "I keep decisions flexible and adjust continuously", score: 3 },
              { id: "B", text: "I make provisional decisions without explicit review points", score: 3 },
              { id: "C", text: "I commit with a clear revisit point or trigger", score: 5 },
              { id: "D", text: "I delay commitment until more capacity opens up", score: 2 }
            ]
          }
        ]
      },
      {
        scenarioId: "S2",
        title: "Scenario 2: Everyday Judgment",
        subtitle: "Moderate stakes, cumulative consequences",
        context:
          "Over the past several weeks, you have noticed that a recurring type of decision keeps landing back on your desk. These are not high-stakes calls, but they require judgment and context that others on your team could reasonably develop. Stepping in ensures quality and efficiency, but it also reinforces dependency and increases your own load. Letting go creates short-term discomfort and uneven outcomes, but may strengthen judgment and lack of ownership over time. There is no immediate failure. However, how you handle this will shape both your workload and how judgment develops across the team.",
        questions: [
          {
            id: "q7",
            prompt: "What is the core decision you need to make?",
            type: "mcq",
            dimension: "DF",
            options: [
              { id: "A", text: "How to ensure these decisions are made correctly", score: 3 },
              { id: "B", text: "How to balance personal efficiency with team development", score: 5 },
              { id: "C", text: "How to reduce the number of decisions coming to you", score: 4 },
              { id: "D", text: "Whether these decisions are important enough to address right now", score: 2 }
            ]
          },
          {
            id: "q8",
            prompt: "Which cost are you most willing to accept?",
            type: "mcq_rank",
            dimension: "TO",
            options: [
              { id: "A", text: "Short-term inefficiency as others learn", score: 5 },
              { id: "B", text: "Continued interruption to your own focus and time", score: 2 },
              { id: "C", text: "Inconsistent outcomes in lower-impact decisions", score: 4 },
              { id: "D", text: "Temporary frustration from team members", score: 4 }
            ],
            rankRequired: true
          },
          {
            id: "q9",
            prompt: "How strong is your instinct to step in and handle these decisions yourself?",
            type: "likert_awareness",
            dimension: "IR",
            minLabel: "Very weak",
            maxLabel: "Very strong",
            likertMap: { 1:2, 2:3, 3:4, 4:5, 5:5 }
          },
          {
            id: "q10",
            prompt: "Which best reflects how you handle that instinct?",
            type: "mcq",
            dimension: "IR",
            options: [
              { id: "A", text: "I treat it as a reliable signal", score: 2 },
              { id: "B", text: "I notice it but often act on it anyway", score: 3 },
              { id: "C", text: "I deliberately test whether my involvement is actually necessary", score: 5 },
              { id: "D", text: "I discount it because it reinforces dependency", score: 4 }
            ]
          },
          {
            id: "q11",
            prompt: "Which consideration carries the most weight in your approach?",
            type: "mcq",
            dimension: "TJ",
            options: [
              { id: "A", text: "Keeping things moving smoothly right now", score: 2 },
              { id: "B", text: "Protecting your own time and energy", score: 3 },
              { id: "C", text: "Building judgment capability in others", score: 5 },
              { id: "D", text: "Avoiding short-term discomfort or fixing potential mistakes", score: 2 }
            ]
          },
          {
            id: "q12",
            prompt: "Which best describes your commitment approach?",
            type: "mcq",
            dimension: "CD",
            options: [
              { id: "A", text: "I continue handling these decisions myself", score: 2 },
              { id: "B", text: "I delegate selectively but stay closely involved", score: 3 },
              { id: "C", text: "I clarify decision boundaries and let others own outcomes", score: 5 },
              { id: "D", text: "I delay changing anything until pressure forces it", score: 2 }
            ]
          }
        ]
      },
      {
        scenarioId: "S3",
        title: "Scenario 3: Stress and Disruption Judgment",
        subtitle: "Acute pressure and reputational risk",
        context:
          "A public-facing issue emerges unexpectedly. Facts are incomplete. Internal teams disagree on severity. External stakeholders are asking for a response. Acting too quickly risks error; waiting risks loss of trust.",
        questions: [
          {
            id: "q13",
            prompt: "What is the primary decision you need to make?",
            type: "mcq",
            dimension: "DF",
            options: [
              { id: "A", text: "How to control the narrative", score: 2 },
              { id: "B", text: "Whether to act now or pause", score: 3 },
              { id: "C", text: "How to accelerate fact-finding and response readiness", score: 5 },
              { id: "D", text: "Who should own external communication", score: 4 }
            ]
          },
          {
            id: "q14",
            prompt: "Which risk concerns you more?",
            type: "mcq",
            dimension: "TO",
            options: [
              { id: "A", text: "Acting with incomplete information", score: 5 },
              { id: "B", text: "Appearing slow or unresponsive", score: 3 }
            ]
          },
          {
            id: "q15",
            prompt: "What is your first instinctive reaction?",
            type: "mcq",
            dimension: "IR",
            options: [
              { id: "A", text: "Move fast to demonstrate control", score: 2 },
              { id: "B", text: "Pause to avoid mistakes", score: 4 },
              { id: "C", text: "Delegate the response", score: 3 },
              { id: "D", text: "Seek broad alignment", score: 4 }
            ]
          },
          {
            id: "q16",
            prompt: "How reliable do you believe your instinct is in situations like this?",
            type: "likert_reverse",
            dimension: "IR",
            minLabel: "Not reliable",
            maxLabel: "Extremely reliable"
          },
          {
            id: "q17",
            prompt: "Which outcome most strongly shapes your next 24-hour actions?",
            type: "mcq",
            dimension: "TJ",
            options: [
              { id: "A", text: "Immediate reassurance", score: 2 },
              { id: "B", text: "Accuracy of public statements", score: 4 },
              { id: "C", text: "Preservation of long-term trust", score: 5 },
              { id: "D", text: "Internal clarity and alignment", score: 4 }
            ]
          },
          {
            id: "q18",
            prompt: "What do you do first?",
            type: "mcq",
            dimension: "CD",
            options: [
              { id: "A", text: "Issue a public statement", score: 2 },
              { id: "B", text: "Align internally without external communication", score: 3 },
              { id: "C", text: "Launch a rapid fact-finding sprint with a response deadline", score: 5 },
              { id: "D", text: "Wait until more clarity emerges", score: 2 }
            ]
          }
        ]
      },
      {
        scenarioId: "CAL",
        title: "Assessment Calibration",
        subtitle: "Final Calibration Check",
        context:
          "Confidence Level",
        questions: [
          {
            id: "q19",
            prompt: "How confident are you in the quality of your decisions across the scenarios above?",
            type: "likert_direct",
            dimension: null,
            minLabel: "Very low",
            maxLabel: "Very high"
          }
        ]
      }
    ];

    const flat = [];
    questionnaire.forEach(s => s.questions.forEach(q => flat.push({ scenario: s, q })));

    document.addEventListener("DOMContentLoaded", () => {
      const submissionForm = document.getElementById("submissionForm");
      const laterForm = document.getElementById("takeLaterForm");
      const startForm = document.getElementById("startNowForm");
      if (submissionForm) submissionForm.action = APPS_SCRIPT_URL;
      if (laterForm) laterForm.action = APPS_SCRIPT_URL;
      if (startForm) startForm.action = APPS_SCRIPT_URL;

      const params = new URLSearchParams(window.location.search);
      const startNow = params.get("start") === "now" || params.get("mode") === "now";
      if (startNow) showTakeNowForm();
    });

    function backToIntroChoices() {
      document.getElementById("intro-choices").style.display = "flex";
      document.getElementById("intro-later-form").style.display = "none";
      document.getElementById("intro-now-form").style.display = "none";
      document.getElementById("intro-later-thanks").style.display = "none";
    }

    function showTakeLaterForm() {
      document.getElementById("intro-choices").style.display = "none";
      document.getElementById("intro-now-form").style.display = "none";
      document.getElementById("intro-later-thanks").style.display = "none";
      document.getElementById("intro-later-form").style.display = "block";
    }

    function showTakeNowForm() {
      document.getElementById("intro-choices").style.display = "none";
      document.getElementById("intro-later-form").style.display = "none";
      document.getElementById("intro-later-thanks").style.display = "none";
      document.getElementById("intro-now-form").style.display = "block";
    }

    function submitTakeLaterEmail() {
      const emailInput = document.getElementById("reminderEmail");
      const email = (emailInput.value || "").trim();

      if (!email) { alert("Please enter your email address so we can send you the assessment link later."); emailInput.focus(); return; }
      if (!validateEmail(email)) { alert("Please enter a valid email address (e.g., name@example.com)."); emailInput.focus(); return; }

      const laterForm = document.getElementById("takeLaterForm");
      document.getElementById("takeLaterEmail").value = email;
      laterForm.submit();

      document.getElementById("intro-later-form").style.display = "none";
      document.getElementById("intro-later-thanks").style.display = "block";
      emailInput.value = "";
    }

    function submitTakeNowEmail() {
      const emailInput = document.getElementById("startNowEmail");
      const email = (emailInput.value || "").trim();

      if (!email) { alert("Please enter your email address to start the assessment."); emailInput.focus(); return; }
      if (!validateEmail(email)) { alert("Please enter a valid email address (e.g., name@example.com)."); emailInput.focus(); return; }

      assessmentEmail = email;
      assessmentStartMs = Date.now();

      document.getElementById("userEmail").value = email;

      const startForm = document.getElementById("startNowForm");
      document.getElementById("startNowHiddenEmail").value = email;
      startForm.submit();

      document.getElementById("intro-screen").style.display = "none";
      document.getElementById("assessment-screen").style.display = "block";

      currentIndex = 0;
      renderCurrent();

      emailInput.value = "";
      const wrapper = document.querySelector(".assessment-wrapper");
      window.scrollTo({ top: wrapper.offsetTop, behavior: "smooth" });
    }

    function renderCurrent() {
      document.getElementById("results").style.display = "none";
      document.getElementById("completedScreen").style.display = "none";

      const item = flat[currentIndex];
      const scenario = item.scenario;
      const q = item.q;

      const scenarioCard = document.getElementById("scenarioCard");
      scenarioCard.style.display = "block";
      document.getElementById("scenarioTitle").textContent = scenario.title;

      const subtitleEl = document.getElementById("scenarioSubtitle");
      if (scenario.subtitle) {
        subtitleEl.textContent = scenario.subtitle;
        subtitleEl.style.display = "block";
      } else {
        subtitleEl.textContent = "";
        subtitleEl.style.display = "none";
      }

      document.getElementById("scenarioContext").textContent = scenario.context;

      document.getElementById("progressScenario").textContent = "Progress";
      document.getElementById("progressCount").textContent = `Question ${currentIndex + 1} of ${flat.length}`;
      const pct = Math.round(((currentIndex) / (flat.length - 1)) * 100);
      document.getElementById("progressBarFill").style.width = `${pct}%`;

      document.getElementById("questionHeader").textContent = q.prompt;
      document.getElementById("questionPrompt").textContent = "";
      document.getElementById("questionPrompt").style.display = "none";

      const optionsWrap = document.getElementById("questionOptions");
      optionsWrap.innerHTML = "";

      document.getElementById("rankBox").style.display = "none";
      document.getElementById("rankGrid").innerHTML = "";

      const existing = answers[q.id];

      if (q.type === "mcq" || q.type === "mcq_rank") {
        const opts = document.createElement("div");
        opts.className = "options";

        q.options.forEach(opt => {
          const row = document.createElement("label");
          row.className = "option";

          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = q.id;
          radio.value = opt.id;
          if (existing && existing.choiceId === opt.id) radio.checked = true;

          radio.addEventListener("change", () => {
            saveMcqAnswer(q, opt);
            if (q.type === "mcq_rank") showRankUI(q, opt.id);
            setNextEnabled(true);
          });

          const text = document.createElement("div");
          text.className = "opt-text";
          text.textContent = opt.text;

          row.appendChild(radio);
          row.appendChild(text);
          opts.appendChild(row);
        });

        optionsWrap.appendChild(opts);

        if (q.type === "mcq_rank" && existing && existing.choiceId) {
          showRankUI(q, existing.choiceId);
        }

        setNextEnabled(!!(existing && existing.choiceId));

      } else if (q.type === "likert_direct" || q.type === "likert_awareness" || q.type === "likert_reverse") {
        const likert = document.createElement("div");
        likert.className = "likert-row";

        const selectedVal = existing && existing.meta ? existing.meta.selectedLikert : null;

        for (let i=1; i<=5; i++) {
          const pill = document.createElement("div");
          pill.className = "likert-pill" + (selectedVal === i ? " selected" : "");
          pill.textContent = String(i);

          pill.addEventListener("click", () => {
            document.querySelectorAll(".likert-pill").forEach(p => p.classList.remove("selected"));
            pill.classList.add("selected");
            saveLikertAnswer(q, i);
            setNextEnabled(true);
          });

          likert.appendChild(pill);
        }

        optionsWrap.appendChild(likert);

        const labels = document.createElement("div");
        labels.className = "likert-labels";
        labels.innerHTML = `<span>${q.minLabel || ""}</span><span>${q.maxLabel || ""}</span>`;
        optionsWrap.appendChild(labels);

        setNextEnabled(selectedVal !== null);

      } else {
        optionsWrap.innerHTML = "<div class='note'>Unsupported question type.</div>";
        setNextEnabled(false);
      }

      const prev = document.getElementById("btnPrev");
      prev.disabled = (currentIndex === 0);
      prev.classList.toggle("btn-disabled", currentIndex === 0);

      const next = document.getElementById("btnNext");
      next.textContent = (currentIndex === flat.length - 1) ? "Finish" : "Next";
    }

    function setNextEnabled(enabled) {
      const btn = document.getElementById("btnNext");
      btn.disabled = !enabled;
      btn.classList.toggle("btn-disabled", !enabled);
    }

    function prevQuestion() {
      if (currentIndex > 0) {
        currentIndex -= 1;
        renderCurrent();
      }
    }

    function nextQuestion() {
      const q = flat[currentIndex].q;
      if (!answers[q.id]) return;

      if (currentIndex < flat.length - 1) {
        currentIndex += 1;
        renderCurrent();
      } else {
        finishAssessment();
      }
    }

    function showRankUI(q, selectedChoiceId) {
      const remaining = q.options.filter(o => o.id !== selectedChoiceId);

      const box = document.getElementById("rankBox");
      const grid = document.getElementById("rankGrid");
      box.style.display = "block";
      grid.innerHTML = "";

      const currentAnswer = answers[q.id] || {};
      const meta = currentAnswer.meta || {};
      const rankState = meta.rank || {}; // { optId: 1|2|3 }

      const selectRefs = {}; // optId -> selectEl

      function buildOptionsHtml(currentVal, usedValsSet) {
        const opts = [
          { v: "",  t: "Select rank" },
          { v: "1", t: "Most acceptable" },
          { v: "2", t: "More acceptable" },
          { v: "3", t: "Least acceptable" }
        ];

        return opts
          .filter(o => o.v === "" || o.v === String(currentVal) || !usedValsSet.has(o.v))
          .map(o => `<option value="${o.v}">${o.t}</option>`)
          .join("");
      }

      function updateAllDropdowns() {
        const picked = {};
        remaining.forEach(opt => {
          const v = rankState[opt.id];
          picked[opt.id] = v ? String(v) : "";
        });

        remaining.forEach(opt => {
          const sel = selectRefs[opt.id];
          if (!sel) return;

          const used = new Set();
          remaining.forEach(other => {
            if (other.id === opt.id) return;
            const ov = picked[other.id];
            if (ov) used.add(ov);
          });

          const curVal = picked[opt.id] || "";
          sel.innerHTML = buildOptionsHtml(curVal, used);
          sel.value = curVal;
        });
      }

      remaining.forEach(opt => {
        const row = document.createElement("div");
        row.className = "rank-row";

        const left = document.createElement("div");
        left.textContent = opt.text;

        const sel = document.createElement("select");
        selectRefs[opt.id] = sel;

        sel.innerHTML = `
          <option value="">Select rank</option>
          <option value="1">Most acceptable</option>
          <option value="2">More acceptable</option>
          <option value="3">Least acceptable</option>
        `;

        if (rankState[opt.id]) sel.value = String(rankState[opt.id]);

        sel.addEventListener("change", () => {
          const val = sel.value ? parseInt(sel.value, 10) : null;

          rankState[opt.id] = val;
          meta.rank = rankState;
          currentAnswer.meta = meta;
          answers[q.id] = currentAnswer;

          updateAllDropdowns();
        });

        row.appendChild(left);
        row.appendChild(sel);
        grid.appendChild(row);
      });

      updateAllDropdowns();
    }

    function saveMcqAnswer(q, opt) {
      const scoreByDim = {};
      if (q.dimension) scoreByDim[q.dimension] = opt.score;

      answers[q.id] = { choiceId: opt.id, scoreByDim: scoreByDim, meta: { optionText: opt.text } };
    }

    function saveLikertAnswer(q, selected) {
      const scoreByDim = {};
      let score = selected;

      if (q.type === "likert_awareness") {
        score = (q.likertMap && q.likertMap[selected]) ? q.likertMap[selected] : selected;
      } else if (q.type === "likert_reverse") {
        score = 6 - selected;
      }

      if (q.dimension) scoreByDim[q.dimension] = score;

      answers[q.id] = { choiceId: String(selected), scoreByDim: scoreByDim, meta: { selectedLikert: selected } };
    }

    function finishAssessment() {
      const email = assessmentEmail || (document.getElementById("userEmail").value || "").trim();
      if (!email || !validateEmail(email)) {
        alert("Email is missing or invalid. Please restart and enter a valid email.");
        return;
      }

      const buckets = { DF: [], TO: [], IR: [], TJ: [], CD: [] };

      Object.keys(answers).forEach(qid => {
        const a = answers[qid];
        if (!a || !a.scoreByDim) return;
        Object.keys(a.scoreByDim).forEach(dimKey => {
          if (buckets[dimKey]) buckets[dimKey].push(a.scoreByDim[dimKey]);
        });
      });

      const dimScores = {};
      Object.keys(buckets).forEach(k => dimScores[k] = average(buckets[k]));

      const stressScenario = questionnaire.find(s => s.scenarioId === "S3");
      const stressQids = stressScenario.questions.map(x => x.id);

      const stressBuckets = { DF: [], TO: [], IR: [], TJ: [], CD: [] };
      stressQids.forEach(qid => {
        const a = answers[qid];
        if (!a || !a.scoreByDim) return;
        Object.keys(a.scoreByDim).forEach(dimKey => {
          if (stressBuckets[dimKey]) stressBuckets[dimKey].push(a.scoreByDim[dimKey]);
        });
      });

      const stressDimScores = {};
      Object.keys(stressBuckets).forEach(k => stressDimScores[k] = average(stressBuckets[k]));

      const stability = average([
        stressDimScores.DF, stressDimScores.TO, stressDimScores.IR, stressDimScores.TJ, stressDimScores.CD
      ].filter(v => isFinite(v)));

      const coreAvg = average([dimScores.DF, dimScores.TO, dimScores.IR, dimScores.TJ, dimScores.CD].filter(v => isFinite(v)));

      let band = computeBand(coreAvg, stability, dimScores);
      if (dimScores.DF < 3.0 || dimScores.IR < 3.0) band = Math.min(band, 3);
      if (stability < 2.5) band = Math.min(band, 2);

      const calibration = (answers["q19"] && answers["q19"].meta) ? answers["q19"].meta.selectedLikert : null;

      // Submit first so it always records
      submitToAppsScript(email, dimScores, stability, coreAvg, band, calibration, answers);

      // Show Completed screen first; results behind a button
      showCompleted(dimScores, stability, coreAvg, band);
    }

    function showCompleted(dimScores, stability, coreAvg, band) {
      lastComputedResults = { dimScores, stability, coreAvg, band };
      document.getElementById("results").style.display = "none";
      document.getElementById("completedScreen").style.display = "block";

      // Disable nav buttons
      document.getElementById("btnPrev").disabled = true;
      document.getElementById("btnNext").disabled = true;
      document.getElementById("btnPrev").classList.add("btn-disabled");
      document.getElementById("btnNext").classList.add("btn-disabled");
      document.getElementById("btnNext").textContent = "Completed";

      const wrapper = document.querySelector(".assessment-wrapper");
      window.scrollTo({ top: wrapper.offsetTop, behavior: "smooth" });
    }

    function showResults() {
      if (!lastComputedResults) return;
      document.getElementById("completedScreen").style.display = "none";
      renderResults(
        lastComputedResults.dimScores,
        lastComputedResults.stability,
        lastComputedResults.coreAvg,
        lastComputedResults.band
      );
    }

    function renderResults(dimScores, stability, coreAvg, band) {
      const results = document.getElementById("results");
      const grid = document.getElementById("dimensionResults");
      const bandText = document.getElementById("bandText");
      const interp = document.getElementById("bandInterpretation");

      grid.innerHTML = "";

      const rows = [
        { label: DIM_LABEL.DF, value: dimScores.DF },
        { label: DIM_LABEL.TO, value: dimScores.TO },
        { label: DIM_LABEL.IR, value: dimScores.IR },
        { label: DIM_LABEL.TJ, value: dimScores.TJ },
        { label: DIM_LABEL.CD, value: dimScores.CD },
        { label: DIM_LABEL.JS, value: stability },
        { label: "Core Average", value: coreAvg }
      ];

      rows.forEach(r => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${r.label}</strong><br>Score: ${format1(r.value)} ${scoreBadge(r.value)}`;
        grid.appendChild(div);
      });

      // Band placement: green badge only
      bandText.innerHTML = `<span class="badge badge-high">Band ${band}</span>`;

      interp.innerHTML = bandInterpretation(band, dimScores, stability);

      results.style.display = "block";

      const wrapper = document.querySelector(".assessment-wrapper");
      window.scrollTo({ top: wrapper.offsetTop, behavior: "smooth" });
    }

    function submitToAppsScript(email, dimScores, stability, coreAvg, band, calibration, answersObj) {
      const form = document.getElementById("submissionForm");
      if (!form) return;

      document.getElementById("formEmail").value = email || "";

      document.getElementById("formDecisionFraming").value = format1(dimScores.DF);
      document.getElementById("formTradeoffOwnership").value = format1(dimScores.TO);
      document.getElementById("formInstinctRegulation").value = format1(dimScores.IR);
      document.getElementById("formTemporalJudgment").value = format1(dimScores.TJ);
      document.getElementById("formCommitmentDiscipline").value = format1(dimScores.CD);

      document.getElementById("formJudgmentStability").value = format1(stability);
      document.getElementById("formCoreAverage").value = format1(coreAvg);
      document.getElementById("formBand").value = `Band ${band}`;
      document.getElementById("formConfidenceCalibration").value = (calibration === null || calibration === undefined) ? "" : String(calibration);

      // Timing
      const endMs = Date.now();
      document.getElementById("formStartMs").value = assessmentStartMs ? String(assessmentStartMs) : "";
      document.getElementById("formEndMs").value = String(endMs);
      document.getElementById("formDurationSec").value =
        assessmentStartMs ? String(Math.round((endMs - assessmentStartMs) / 1000)) : "";

      // (answers_json is intentionally not sent; if you add it later, guard it)
      const aj = document.getElementById("formAnswersJson");
      if (aj) aj.value = JSON.stringify(answersObj || {});

      form.submit();
    }

    function computeBand(avg, stability, dimScores) {
      if (!isFinite(avg) || !isFinite(stability)) return 1;
      const anyBelow18 = Object.values(dimScores).some(v => isFinite(v) && v < 1.8);

      if (avg < 2.0 || anyBelow18) return 1;
      if (avg >= 2.0 && avg <= 2.9 && stability >= 2.0) return 2;
      if (avg >= 3.0 && avg <= 3.7 && stability >= 3.0) return 3;
      if (avg >= 3.8 && avg <= 4.4 && stability >= 3.6) return 4;
      if (avg >= 4.5 && stability >= 4.2) return 5;

      if (avg >= 4.5 && stability < 4.2) return 4;
      if (avg >= 3.8 && stability < 3.6) return 3;
      if (avg >= 3.0 && stability < 3.0) return 2;
      return 2;
    }

    function bandName(band) {
      switch (band) {
        case 1: return "Fragile Judgment Proficiency";
        case 2: return "Situational Judgment Proficiency";
        case 3: return "Functional Judgment Proficiency";
        case 4: return "Advanced Judgment Proficiency";
        case 5: return "Expert Judgment Proficiency";
        default: return "Judgment Proficiency";
      }
    }

    function bandInterpretation(band, dimScores, stability) {
      const lows = lowestDimensions(dimScores, 2);
      const lowText = lows.map(x => `${x.label} (${format1(x.value)})`).join(", ");

      if (band === 1) {
        return `<p><span class="score-risk">Pattern:</span> Fragile reliability. Under pressure, judgment may become reactive or inconsistent. The fastest improvement comes from strengthening: <strong>${lowText}</strong>.</p>`;
      }
      if (band === 2) {
        return `<p><span class="score-watch">Pattern:</span> Situational reliability. You show pockets of strong judgment, but it is not yet stable across contexts. Most leverage comes from improving: <strong>${lowText}</strong>.</p>`;
      }
      if (band === 3) {
        return `<p><span class="score-strong">Pattern:</span> Functional reliability. Judgment is generally usable and steady. To scale your decision impact, strengthen: <strong>${lowText}</strong>.</p>`;
      }
      if (band === 4) {
        return `<p><span class="score-strong">Pattern:</span> Advanced reliability. You sustain disciplined judgment in ambiguity and stress. Next gains are edge-case stability and faster instinct testing. Watch: <strong>${lowText}</strong>.</p>`;
      }
      return `<p><span class="score-strong">Pattern:</span> Expert reliability. Judgment remains disciplined even under stress and ambiguity. Maintain your floor by monitoring: <strong>${lowText}</strong>.</p>`;
    }

    function lowestDimensions(dimScores, n) {
      const rows = [
        { label: DIM_LABEL.DF, value: dimScores.DF },
        { label: DIM_LABEL.TO, value: dimScores.TO },
        { label: DIM_LABEL.IR, value: dimScores.IR },
        { label: DIM_LABEL.TJ, value: dimScores.TJ },
        { label: DIM_LABEL.CD, value: dimScores.CD }
      ].filter(x => isFinite(x.value));
      rows.sort((a,b) => a.value - b.value);
      return rows.slice(0, n);
    }

    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function average(arr) {
      const nums = (arr || []).filter(v => typeof v === "number" && isFinite(v));
      if (nums.length === 0) return NaN;
      return nums.reduce((a,b) => a + b, 0) / nums.length;
    }

    function format1(val) {
      if (!isFinite(val)) return "n/a";
      return (Math.round(val * 10) / 10).toFixed(1);
    }

    function scoreBadge(score) {
      if (!isFinite(score)) return "";
      if (score <= 2.0) return `<span class="badge badge-low">Low</span>`;
      if (score <= 3.4) return `<span class="badge badge-mid">Mid</span>`;
      return `<span class="badge badge-high">High</span>`;
    }

    function shareAssessment() {
      const url = window.location.href.split("?")[0];
      const shareText = `Take the JQ Assessment: ${url}`;

      if (navigator.share) {
        navigator.share({ title: "JQ Assessment", text: shareText, url })
          .catch(() => copyToClipboard(shareText));
      } else {
        copyToClipboard(shareText);
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert("Link copied to clipboard.");
      }).catch(() => {
        prompt("Copy this link:", text);
      });
    }

    function openKrishnaBooking() {
      window.open("https://cal.com/krishnapendyala", "_blank", "noopener,noreferrer");
    }

    function printPage() { window.print(); }
  </script>

</body>
</html>
